 

// test


// set up global variables

    // set up internal system or placeholder variables
let alive = false
let level = 0
let stnOutPt = 0 // origanaly used to hold an output for an old function that does not exist anymore thats pourpos was to turn strings to numbrs. now it has no real use other than to fill an unesesary peramater in the ntq function whos pourpos is to take a number and start the corosponding level. this variable and it's corosponding function is over-all outdated and needs to be changed in a code clean up update.
let godMode = false
let codeidentfyr = true // currently unknown what this variable was made for
let priebe = false // if priebe is loged in



    // variables for free Play
let isFreeplayOnUpdategoing = false // a variable that holds wheater or not free play is giveing the player points
let speed: any = 120
let fpause: any = 800
let sideasteroids = ' Off'
let realSideAsteroids = false
let isInMenue = true
let savefreeplay = 'On'
let topAsteroids = 'On'
let realTopAsteroids = true
let sideSpeed = 92
let fSidePause = 1900
let fSideMinSpeed = 92


    // set up sprite variables and veriables for sprites
let Ship: Sprite = null
let asteroid: Sprite = null
let verstion: any = null // variable for the verstion number in the bottom
let vertionNumber: string = '1.1.2' // variable to cnage the verstion in only one place compleatly for my convinece while codeing 
let godmodetext: any = null
let astronot: Sprite = null





// give settings defalt values and/or change nessasery variables (settings set up)
if (!(blockSettings.exists("verstion"))){
verstionSetUp()
} else if (blockSettings.readString("verstion") == "true") {
    verstionSetUp()
}

if (!(blockSettings.exists("God Mode"))) {
    godMode = false
} else if (blockSettings.readString("God Mode") == "true" && blockSettings.readString("logedInToDev") == "true") {
    godMode = true
    godmodetext = textsprite.create("God Mode on")
    godmodetext.setPosition(65, 0)
    godmodetext.setOutline(2, 5)
} else {
    godMode = false
}

    // free play settings
if (!(blockSettings.exists("Free play save"))) {
    savefreeplay = 'On'
}

if (!(blockSettings.exists("fPause"))) {
    blockSettings.writeNumber("fPause", 800)
} else {
    fpause = settings.readNumber("fPause")
}

if (!(blockSettings.exists("fSpeed"))) {
    blockSettings.writeNumber("fSpeed", 120)
}

if (! (blockSettings.exists("fSideAsteroids"))) {
    blockSettings.writeString("fSideAsteroids", "false")
} else {
    if (blockSettings.readString('fSideAsteroids') == 'true') {
        realSideAsteroids = true
        sideasteroids = 'Off'
    }
}

if (!(blockSettings.exists('fTopAsteroids'))) {
    blockSettings.writeString('fTopAsteroids', 'true')
} else {
    if (blockSettings.readString('fTopAsteroids') == 'true'){
        realTopAsteroids = true
        topAsteroids = 'On'
    }
}

console.log("setting sinde speed = " + blockSettings.readNumber("FSideSpeed"))
if (!(blockSettings.exists('fSideSpeed'))) {
    settings.writeNumber('fSideSpeed', 92)
    console.log("setting sinde speed = " + blockSettings.readNumber("FSideSpeed"))
}
sideSpeed = settings.readNumber("FSideSpeed")
console.log("side speed = " + sideSpeed)


if (!(blockSettings.exists('fSidePause'))) {
    settings.writeNumber('fSidePause', 1900)
}
    fSidePause = settings.readNumber("fSidePause")
    console.log("Side asteroid  pause = " + fSidePause)



function testfunction(){
    console.log('hi!')
}

//on touched functions
sprites.onOverlap(SpriteKind.Player, SpriteKind.Enemy, function (sprite: Sprite, otherSprite: Sprite) {
    if (godMode == false) {
        alive = false
        effects.starField.endScreenEffect()
        Ship.destroy(effects.fire, 100)
        otherSprite.destroy()
    }
})




function verstionSetUp () {
    verstion = textsprite.create(vertionNumber)
    verstion.setPosition(135, 110)
    verstion.setOutline(2, 6)
}



// regular functions

// function for loading the rocket
function loadrokt() {
    if (priebe == true) {
        Ship = sprites.create(assets.image`priebeShip`, SpriteKind.Player)
    } else {
    Ship = sprites.create(assets.image`Defalt Ship`, SpriteKind.Player)
    animation.runImageAnimation(Ship, 
        [img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5..424252244..5....
            ........54222222244......
            ........5222424244.......
            ........45254222245......
            ........54442425455......
            ........5542544245.......
            .........544425554.......
            .........452455455.......
            ..........545525.........
            ...........5.45..........
            .........................
            .........................
            .........................
        `, img`
        .........................
        .........................
        .........................
        .............1...........
        ............111..........
        ...........11111.........
        ...........11111.........
        ..........1111111........
        ..........1199911........
        ......4...119f911...4....
        .....444..1999991..444...
        .....444..199f991..444...
        .....444.119999911.444...
        .....424.111151111.424...
        .....42441151115114424...
        .....41411111111111414...
        .....41441511f11514414...
        .....4841111fff1111484...
        .....4844111fff1114484...
        .....444111fffff111444...
        .....44441111111114444...
        .....444.111111111.444...
        ......c..ccccccccc..c....
        .....ccc.cc.ccc.cc.ccc...
        .....252ccccccccccc252...
        ......4..4242422.4..4....
        ........52422522244......
        ........52.2424244.......
        ........4525.525245......
        ........54.4242.455......
        ........524254.242.......
        .........5.4..5.5........
        ..........5245..55.......
        ............2............
        .........................
        .........................
        .........................
        .........................
    `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....545ccccccccccc545...
            ......2..424245254..2....
            ........5245252224.......
            ........5252424542.......
            ........44242245245......
            ........54542424555......
            ........5244552242.......
            .......2.454224554.......
            .......25452452255.......
            .........5542425.........
            ...........55.5.4........
            .........................
            .........................
            .........................
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24245254..5....
            ..........25252424.......
            ........4542524242.......
            .......454242545245......
            ........44554254552......
            ..........42452242.......
            ..........252425454......
            ...........455424224.....
            ............25252454.....
            .............24245.......
            .............545.........
            ..............22.........
            .........................
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24225224..5....
            ..........25252424.......
            ..........42425242.......
            ..........242245445......
            .........4545544252......
            .........242425224.......
            ..........244244524......
            ..........42254252.......
            ..........44245524.......
            ...........2524255.......
            ...........445442........
            ...........24.25.........
            ............555..........
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....545ccccccccccc545...
            ......2...22442224..2....
            ..........22252424.......
            ..........442222524......
            .........42542442454.....
            .........4542425452......
            ..........45524452.......
            ..........24242524.......
            .........224544255.......
            ........2545252524.......
            .........44542.42........
            .........54224...........
            ...........5.............
            .........................
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24225224..5....
            ..........25252424.......
            ..........42425242.......
            ..........242245445......
            .........4545544252......
            .........242425224.......
            ..........244244524......
            ..........42254252.......
            ..........44245524.......
            ...........2524255.......
            ...........445442........
            ...........24.25.........
            ............555..........
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24245254..5....
            ..........25252424.......
            ........4542524242.......
            .......454242545245......
            ........44554254552......
            ..........42452242.......
            ..........252425454......
            ...........45542422......
            ............2525245......
            .............24245.......
            .............545.........
            ..............22.........
            .........................
        `],
        200,
        true)
    }
    controller.moveSprite(Ship) // move the ship with the Player controls
    effects.starField.startScreenEffect() // load the stars in the background
    Ship.setStayInScreen(true) // force the ship to stay in the screen

}


// basic level set up
function bLvlSetUp (vlsty: number, puse: number, rept: number, atoend: boolean, loadRkt: boolean, lvl: number) {
    level = lvl
    alive = true
    if (loadRkt == true){
        loadrokt()
    }

    for (let i = 0; i < rept; i++) { // repeat 20 times
        let pos = Math.randomRange(1, 150)
    asteroids(vlsty, puse, 0, true, false) // spawn asteroids 100, 1200
    }


    if (alive == true) {
        if (atoend == true) {
            game.over(true)
        }
    } else {
        pause(1000)
    story.showPlayerChoices("Play again", "Restart")
    if (story.getLastAnswer() == "Play again") {
        ntq(level, stnOutPt)
        stnOutPt
    } else {
        menue()
    }
}
}

// advanced level set up
function advLvlSetUp (minVlsty: number, maxVlsty: number, puse: number, rept: number, atoend: boolean, loadRkt: boolean, lvl: number, minLRVlsty: number, maxLRVlst: number, astrdStartPos: any, xRandPos: boolean, yPosRand: boolean, repalyMenue: boolean) {
    level = lvl
    alive = true
    if(loadRkt == true) {
        loadrokt()
    }

    for (let i = 0; i< rept; i++) {
        let volosty = Math.randomRange(minVlsty, maxVlsty)
        let lRVlsty = Math.randomRange(minLRVlsty, maxLRVlst)
        if (xRandPos == true) {
            astrdStartPos = true
        }

        asteroids(volosty, puse, lRVlsty, astrdStartPos, yPosRand)
    }

    if (alive == true) {
        if (atoend == true && loadRkt == true) {
            game.over(true)
        }
    } else {
        if (repalyMenue == true) {
            pause(1000)
        story.showPlayerChoices("Play again", "Restart")
        if (story.getLastAnswer() == "Play again") {
            ntq(level, stnOutPt)
            stnOutPt
        } else {
            game.reset()
        }
    }
    }
}



// asteroids set up
function asteroids (vlsty: number, puse:  number, lRVlsty: number, astrdStartPos: any, asteroidStartYPos: any) {
    if (alive == true) { // if the player is alive
        let astroType = Math.randomRange(1, 7) // get a random number to sort thrugh random asteroid imgs
        if (astroType == 1) {
            asteroid= sprites.create(assets.image`Astro 1`, SpriteKind.Enemy)
        } else if (astroType == 2) {
            asteroid = sprites.create(assets.image`astro2`, SpriteKind.Enemy)
        } else if (astroType == 3) {
            asteroid = sprites.create(assets.image`astro3`, SpriteKind.Enemy)
        } else if (astroType == 4) {
            asteroid = sprites.create(assets.image`astro4`, SpriteKind.Enemy)
        } else if (astroType == 5) {
            asteroid= sprites.create(assets.image`astro 5`, SpriteKind.Enemy)
        } else if (astroType == 6) {
            asteroid = sprites.create(assets.image`astro6`, SpriteKind.Enemy)
        } else if (astroType == 7) {
            asteroid = sprites.create(assets.image`astro7`, SpriteKind.Enemy)
        }
        let secondPos: any = null
        if (astrdStartPos ==  true) { // not curretly in use

        astrdStartPos = Math.randomRange(1, 160)

        
        //} else if (lRVlsty < 0 && astrdStartPos == true) {
    
          //  astrdStartPos = Math.randomRange(70, 120)

            
        }

        if (asteroidStartYPos == true) {
            secondPos = Math.randomRange(-10, 80)
        }

        console.log(secondPos)
        asteroid.setPosition(astrdStartPos, secondPos)
        
        asteroid.setVelocity(lRVlsty, vlsty)
        asteroid.setFlag(SpriteFlag.AutoDestroy, true)
        pause(puse) // wait 1.2 seconds (the same amount of time it takes for an asteroid to cross the screen)
    }
}



// function for sorting numbers into question functions (I belive this function was barowed from the not so immposible quiz, thus the question insead of level)
function ntq (inpt: number,outpt: any){
    if (inpt == 1){
        bgnGame()
    } else if (inpt == 2) {
        lvl2(true)
    } else if (inpt == 3) {
        lvl3(true)
    }
}








// load levl 1 - then end of the game 
function bgnGame() {
    game.splash("LVL 1")
    bLvlSetUp(100, 1200, 20, false,true,1)
    lvl2(false)
}


// load level 2
function lvl2 (lodrkt: boolean) {
    game.splash("LVL 2")
    bLvlSetUp(150, 1000, 25, false, lodrkt, 2)
    lvl3 (false)
}


//load level 3
function lvl3 (lodrkt: boolean) {
    game.splash("LVL 3")
    timer.background(function() {
        bLvlSetUp(80, 1000, 20, true, lodrkt, 3)
    })

  timer.background(function() {
      advLvlSetUp(90, 100, 1900, 10, true, false, 3, 50, 85, -5, false, true, false)
  })
  pause(300)
    advLvlSetUp(90, 100, 2000, 10, false, false, 3, -50, -85, 160, false, true, false)

lvl4()




}


// load level 4
function lvl4 () {
    if (!(Ship)) {loadrokt()}
    Ship.setStayInScreen(false)
    Ship.setPosition(85,0)
    controller.moveSprite(Ship,0,0)
    effects.starField.endScreenEffect()
    scene.setBackgroundImage(assets.image`marsBackground`)
    story.spriteMoveToLocation(Ship, 80, 80, 50)

    animation.runImageAnimation(Ship, [assets.image`Defalt Ship`], 50, false)
    pause(200)
    story.spriteSayText(Ship,'Wow! We are on Mars!')
    pause(200)
    story.spriteSayText(Ship,'We need to refuel!')
    astronot = sprites.create(img``)
    
}


// menue function (what you see when you load in)
function menue () {




    story.showPlayerChoices("Play Game", "Tutorial", "Skip to level", "Next page")
    if (story.getLastAnswer() == "Next page") {
        story.showPlayerChoices("Settings", "Dev perks (admin)", "Back")

        if (story.getLastAnswer() == "Back") {
            game.reset()


        // set up dev perks
        } else if (story.getLastAnswer() == "Dev perks (admin)") {
            if (!(blockSettings.exists("logedInToDev")) || blockSettings.readString("logedInToDev") == "false"){
                let pasans = game.askForString("Password", 10)
                // Password is 21424314
                if (pasans == "21424314" || pasans == "69B299144" || pasans == "314413" || pasans == "265858") {
                    story.printText("Correct!", 0, 0)
                    blockSettings.writeString("logedInToDev", "true")
                    if (pasans == '314413') {priebe = true}
                    adminPanel()
                    function adminPanel() {
                        story.showPlayerChoices("change variables", "back to main menue", "God Mode", "log out")

                        if (story.getLastAnswer() == "change variables") {
                            story.showPlayerChoices("built in", "man made")
                            if (story.getLastAnswer() == "man made") {
                                story.showPlayerChoices("alive", "level",)
                                if (story.getLastAnswer() == "alive") {
                                    story.showPlayerChoices("true", "false")
                                    if (story.getLastAnswer() == "false") {
                                        alive = false
                                    } else {
                                        alive = true
                                    }
                                } else if (story.getLastAnswer() == "level") {
                                    let devans = game.askForNumber("what would you like to set level to?")
                                    level = devans
                                }
                            } else {
                                // put built in variables hear as they come up
                            }
                        } else if (story.getLastAnswer() == "back to main menue") {
                            menue()
                        } else if (story.getLastAnswer() == "God Mode") {

                            if (godMode == false) {
                                godmodetext = textsprite.create("God Mode on")
                                godmodetext.setPosition(65, 0)
                                godmodetext.setOutline(2,5)
                                godMode = true
                                blockSettings.writeString("God Mode", "true")
                            game.splash("God Mode enabled.")
                            } else {
                                godMode = false
                                godmodetext.destroy()
                                blockSettings.writeString("godMode", "false")
                                game.splash("God Mode disabled.")
                            }
                        } else if (story.getLastAnswer() == "log out") {
                            blockSettings.writeString("logedInToDev", "false")
                            game.reset()
                        }
                        adminPanel()
                    }
                } else {
                    story.printText("Incorrect!", 40, 0)
                    blockSettings.writeString("logedInToDev", "false")
                    game.reset()
                }
            } else {
                adminPanel()
            }
    

        


        // Settings
    } else if (story.getLastAnswer() == "Settings") {
    
        setings()
        function setings () {
        story.showPlayerChoices("Show verstion",/* "Free play save = ".concat(savefreeplay),*/ "Back")

        if (story.getLastAnswer() == "Show verstion") {
            story.showPlayerChoices("true", "false", 'Back')
            if (story.getLastAnswer() == "Back") {
            } else if (story.getLastAnswer() == "false"){
                if (blockSettings.readString("verstion") == "true" || !(blockSettings.exists("verstion"))){
                    blockSettings.writeString("verstion", "false")
                    verstion.destroy()
                } else if (blockSettings.readString("verstion") == "false") {
                    blockSettings.writeString("verstion", "false")
                }
            } else if (story.getLastAnswer() == "true"){
                if (blockSettings.readString("verstion") == "true") {
                    blockSettings.writeString("verstion", "true")
                } else if (blockSettings.readString("verstion") == "false"){
                    blockSettings.writeString("verstion", "true")
                    verstionSetUp()
                }

            }
        } else if (story.getLastAnswer() == `Free play save = ${savefreeplay}`){
            if (savefreeplay == 'On'){
            game.splash("Are you shure you want to turn off free play saveing? This will delete your current settings.")
            story.showPlayerChoices("Yes turn off saveing and delete my settings", "Back")

            if (story.getLastAnswer() == 'Yes turn off saveing and delete my settings') {
                settings.writeString('Free play save', 'false')
                savefreeplay = 'Off'
            }
            } else {
                savefreeplay = 'On'
                settings.writeString('Free play save', 'true')
            }

        }
        setings()
    }
    }



    // Tutorial
    } else if (story.getLastAnswer() == "Tutorial") {
        story.printText("Conferm Tutorial", 72, 62)
        story.showPlayerChoices("Continue", "Go Back")
        if (story.getLastAnswer() == "Continue") {
            bLvlSetUp(0, 0, 0, false, true, 0)
            story.printText("Use the arow keys to move!", 40, 0)
            pause(1000)
            story.printText("Dont hit the asteroids!", 40, 0)
            for (let i = 0; i < 5; i++) {
                let pos = Math.randomRange(1, 150)
                asteroids(100, 1200, 0, true, false)
            }
            if (alive == false) {
                story.printText("Uh oh! Lets try again", 40, 0)
                bLvlSetUp(0, 0, 0, false, true, 0)
                pause(100)
                for (let i = 0; i < 5; i++) {
                    let pos = Math.randomRange(1, 150)
                    asteroids(100, 1200, 0, true, false)
                }
                if (alive == false) {
                    story.printText("you'l get the hang of it!", 40, 0)
                }
            }
            story.printText("Now to infinity and beond!", 40, 0)
            game.reset()


        } else {
            game.reset()
        }



    }
    else if (story.getLastAnswer() == "Play Game") {
        story.showPlayerChoices("Play Cutscene", "Skip Cutscene", "Free play", "Back")
        if (story.getLastAnswer() == "Back") {
            game.reset()
        } else if (story.getLastAnswer() == "Skip Cutscene") {
            bgnGame()
        } else if (story.getLastAnswer() == "Free play") {
            freePlay()
            menue()
        } else {
            let orgnlship= sprites.create(assets.image`originalShip`)
            scaling.scaleByPercent(orgnlship, 100, ScaleDirection.Uniformly, ScaleAnchor.Middle)
            animation.runImageAnimation(orgnlship, [img`
                ....................
                ....................
                ....................
                ....................
                ....................
                .....221............
                ..2.54511188111.....
                ...242411188211555..
                ...254511111111555..
                .....2511122211.....
                ......21............
                ....................
                ....................
                ....................
                ....................
                ....................
            `,
            img`
    ....................
    ....................
    ....................
    ....................
    ....................
    .......1............
    .....5211188111.....
    ....42211188211555..
    ....5.511111111555..
    .....4211122211.....
    .......1............
    ....................
    ....................
    ....................
    ....................
    ....................
`,
            img`
    ....................
    ....................
    ....................
    ....................
    ....................
    ......21............
    ....42411188111.....
    ...422411188211555..
    ..4524511111111555..
    ....52511122211.....
    ......21............
    ....................
    ....................
    ....................
    ....................
    ....................
`], 150, true)

            effects.blizzard.startScreenEffect()

            orgnlship.setPosition(-10, 85)
            story.spriteMoveToLocation(orgnlship, 80, 70, 80) // (spiteName, X val, Yval, Volocity)

            pause(200)

            let alienShip = sprites.create(assets.image`alienShip`, SpriteKind.Enemy)
            alienShip.setPosition(-10, 10)
            scaling.scaleByPercent(alienShip, 100, ScaleDirection.Uniformly, ScaleAnchor.Middle)
            story.spriteMoveToLocation(alienShip, 60, 40, 100)


            story.spriteSayText(alienShip, "We will have our vengence!")

            let enemyRocket = sprites.create(assets.image`enemyRoketDiagnle`, SpriteKind.Enemy)
            enemyRocket.setPosition(60, 40)
            story.spriteMoveToLocation(enemyRocket, 80, 60, 100)

            animation.runImageAnimation(enemyRocket, [assets.image`explode`,
            img`
    . . . . . . 3 3 . . . . . . . .
    . . . . . . 3 1 3 . . . . . . .
    . . 3 3 . . 3 1 3 . . 3 3 . . .
    . . 3 1 3 . 3 1 3 2 3 1 3 . . .
    . . . 3 1 3 3 1 3 2 1 3 . . . .
    3 3 3 3 2 1 3 1 1 1 3 . . . . .
    3 1 1 1 1 1 1 1 1 2 3 3 3 3 3 3
    . 3 3 3 2 3 1 1 1 1 1 1 1 1 1 3
    . . . . . 2 1 1 1 3 3 2 3 3 3 .
    . . . . 3 1 3 1 3 1 2 . . . . .
    . . . 3 1 3 2 1 3 3 1 3 . . . .
    . . 3 1 3 . 2 1 3 . 3 1 3 . . .
    . . 3 3 . . 3 1 3 . . 3 3 . . .
    . . . . . . 3 1 3 . . . . . . .
    . . . . . . 3 1 3 . . . . . . .
    . . . . . . 3 3 . . . . . . . .
`,
            img`
    . . 3 3 . . . 3 3 . . . . . . .
    . 3 1 1 2 . . 3 1 3 . . 3 3 3 .
    . 3 1 1 2 . . 3 1 3 . 3 1 1 3 .
    . . 3 2 2 . . 2 1 2 . 2 1 1 3 .
    . 3 3 . . . . . 2 2 . 2 2 2 . .
    3 1 1 2 2 . . . . . . . 3 3 . .
    3 1 1 1 2 . . . . . . 2 1 1 3 3
    3 1 1 2 . . . . . . 3 1 1 1 1 3
    . 3 2 2 . . . . . . . 2 1 1 3 .
    . . . . . . . 2 . . . . 3 3 . .
    . . 2 2 2 . 2 1 2 . . 2 2 2 . .
    . 3 1 1 2 2 3 1 1 2 . 2 1 1 3 3
    3 1 1 1 2 2 1 1 1 2 . 2 1 1 1 3
    3 1 1 3 . . 3 1 3 . . . 3 1 1 3
    3 3 3 . . . . 3 3 . . . . 3 3 .
    . . . . . . . . . . . . . . . .
`,
            img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . 3 . . . . .
    . . . . . 3 . . . . 3 3 . . . .
    . . . . 3 3 . . . . . 3 . . . .
    . . . . 3 . . . 3 . . . . . . .
    . . . . . . . . 3 . . . . . . .
    . 3 . . . . . . . . . . 3 . . .
    3 3 . . . . . . . . . . 3 3 . .
    3 . . . . . . . . . . . . 3 . .
    . . . . . . . . . . . . . . . .
    . . . 3 . . . 3 . . . . . 3 . .
    . . 3 3 . . . 3 . . . . . 3 3 .
    . . 3 . . . . 3 . . . . . . 3 .
`,
            img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`], 100, false)


            animation.runImageAnimation(orgnlship, [img`
                ....................
                ....................
                ....................
                ....................
                ....................
                .......1............
                .......11188111.....
                .......11188211555..
                .......11111111555..
                .......11122211.....
                .......1............
                ....................
                ....................
                ....................
                ....................
                ....................
            `], 1, false)



            pause(300)


            enemyRocket = sprites.create(assets.image`enemyRoketDiagnle`, SpriteKind.Enemy)
            enemyRocket.setPosition(60, 40)
            story.spriteMoveToLocation(enemyRocket, 80, 60, 100)

            animation.runImageAnimation(enemyRocket, [img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . 3 3 . . . . . . .
    . . . . . . 3 1 1 3 . . . . . .
    . . . . . . 3 1 1 3 . . . . . .
    . . 3 2 2 3 1 1 1 1 3 2 2 . . .
    . . 3 3 1 1 1 1 1 1 1 1 3 3 . .
    . . 3 3 1 1 1 1 1 1 1 1 3 3 . .
    . . . 3 1 1 1 1 1 1 1 1 3 . . .
    . . . . 3 1 1 1 1 1 1 3 . . . .
    . . . . 2 1 1 1 1 1 1 2 . . . .
    . . . . 2 1 1 3 3 1 1 2 . . . .
    . . . . 3 3 3 2 2 2 3 3 . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`,
            img`
    . . . . . . 3 3 . . . . . . . .
    . . . . . . 3 1 3 . . . . . . .
    . . 3 3 . . 3 1 3 . . 3 3 . . .
    . . 3 1 3 . 3 1 3 2 3 1 3 . . .
    . . . 3 1 3 3 1 3 2 1 3 . . . .
    3 3 3 3 2 1 3 1 1 1 3 . . . . .
    3 1 1 1 1 1 1 1 1 2 3 3 3 3 3 3
    . 3 3 3 2 3 1 1 1 1 1 1 1 1 1 3
    . . . . . 2 1 1 1 3 3 2 3 3 3 .
    . . . . 3 1 3 1 3 1 2 . . . . .
    . . . 3 1 3 2 1 3 3 1 3 . . . .
    . . 3 1 3 . 2 1 3 . 3 1 3 . . .
    . . 3 3 . . 3 1 3 . . 3 3 . . .
    . . . . . . 3 1 3 . . . . . . .
    . . . . . . 3 1 3 . . . . . . .
    . . . . . . 3 3 . . . . . . . .
`,
            img`
    . . 3 3 . . . 3 3 . . . . . . .
    . 3 1 1 2 . . 3 1 3 . . 3 3 3 .
    . 3 1 1 2 . . 3 1 3 . 3 1 1 3 .
    . . 3 2 2 . . 2 1 2 . 2 1 1 3 .
    . 3 3 . . . . . 2 2 . 2 2 2 . .
    3 1 1 2 2 . . . . . . . 3 3 . .
    3 1 1 1 2 . . . . . . 2 1 1 3 3
    3 1 1 2 . . . . . . 3 1 1 1 1 3
    . 3 2 2 . . . . . . . 2 1 1 3 .
    . . . . . . . 2 . . . . 3 3 . .
    . . 2 2 2 . 2 1 2 . . 2 2 2 . .
    . 3 1 1 2 2 3 1 1 2 . 2 1 1 3 3
    3 1 1 1 2 2 1 1 1 2 . 2 1 1 1 3
    3 1 1 3 . . 3 1 3 . . . 3 1 1 3
    3 3 3 . . . . 3 3 . . . . 3 3 .
    . . . . . . . . . . . . . . . .
`,
            img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . 3 . . . . .
    . . . . . 3 . . . . 3 3 . . . .
    . . . . 3 3 . . . . . 3 . . . .
    . . . . 3 . . . 3 . . . . . . .
    . . . . . . . . 3 . . . . . . .
    . 3 . . . . . . . . . . 3 . . .
    3 3 . . . . . . . . . . 3 3 . .
    3 . . . . . . . . . . . . 3 . .
    . . . . . . . . . . . . . . . .
    . . . 3 . . . 3 . . . . . 3 . .
    . . 3 3 . . . 3 . . . . . 3 3 .
    . . 3 . . . . 3 . . . . . . 3 .
`,
            img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`], 100, false)

            story.spriteMoveToLocation(orgnlship, 140, 130, 100)
            alienShip.destroy()

            effects.blizzard.endScreenEffect()

            scene.setBackgroundImage(assets.image`forjinPlanet`)

            orgnlship.setPosition(120, 10)
            timer.background(function () {

                for (let i = 0; i < 20; i++) {
                    scaling.scaleByPercent(orgnlship, -10, ScaleDirection.Uniformly, ScaleAnchor.Middle)
                    pause(50)
                }
            })
            story.spriteMoveToLocation(orgnlship, 90, 40, 50)

            scaling.scaleToPixels(orgnlship, 15, ScaleDirection.Uniformly, ScaleAnchor.Middle)

            animation.runImageAnimation(orgnlship, [img`
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . 4 4 . . . . . . .
            . . . . . . 4 5 5 4 . . . . . .
            . . . . . . 2 5 5 2 . . . . . .
            . . . . . . . 2 2 . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
        `,
            img`
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . 4 . . . . .
            . . . . 2 . . . . 4 4 . . . . .
            . . . . 2 4 . . 4 5 4 . . . . .
            . . . . . 2 4 d 5 5 4 . . . . .
            . . . . . 2 5 5 5 5 4 . . . . .
            . . . . . . 2 5 5 5 5 4 . . . .
            . . . . . . 2 5 4 2 4 4 . . . .
            . . . . . . 4 4 . . 2 4 4 . . .
            . . . . . 4 4 . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
        `,
            img`
            . 3 . . . . . . . . . . . 4 . .
            . 3 3 . . . . . . . . . 4 4 . .
            . 3 d 3 . . 4 4 . . 4 4 d 4 . .
            . . 3 5 3 4 5 5 4 4 d d 4 4 . .
            . . 3 d 5 d 1 1 d 5 5 d 4 4 . .
            . . 4 5 5 1 1 1 1 5 1 1 5 4 . .
            . 4 5 5 5 5 1 1 5 1 1 1 d 4 4 .
            . 4 d 5 1 1 5 5 5 1 1 1 5 5 4 .
            . 4 4 5 1 1 5 5 5 5 5 d 5 5 4 .
            . . 4 3 d 5 5 5 d 5 5 d d d 4 .
            . 4 5 5 d 5 5 5 d d d 5 5 4 . .
            . 4 5 5 d 3 5 d d 3 d 5 5 4 . .
            . 4 4 d d 4 d d d 4 3 d d 4 . .
            . . 4 5 4 4 4 4 4 4 4 4 4 . . .
            . 4 5 4 . . 4 4 4 . . . 4 4 . .
            . 4 4 . . . . . . . . . . 4 4 .
        `,
            img`
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . b b . b b b . . . . .
            . . . . b 1 1 b 1 1 1 b . . . .
            . . b b 3 1 1 d d 1 d d b b . .
            . b 1 1 d d b b b b b 1 1 b . .
            . b 1 1 1 b . . . . . b d d b .
            . . 3 d d b . . . . . b d 1 1 b
            . b 1 d 3 . . . . . . . b 1 1 b
            . b 1 1 b . . . . . . b b 1 d b
            . b 1 d b . . . . . . b d 3 d b
            . b b d d b . . . . b d d d b .
            . b d d d d b . b b 3 d d 3 b .
            . . b d d 3 3 b d 3 3 b b b . .
            . . . b b b d d d d d b . . . .
            . . . . . . b b b b b . . . . .
        `,
            img`
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
        `], 100, false)
            pause(600)
            story.spriteSayText(orgnlship, "Help us! SOS!")

            scene.setBackgroundImage(assets.image`City`)
            Ship = sprites.create(img`
                .........................
                .........................
                ............1............
                ...........111...........
                ..........11111..........
                ..........11111..........
                .........1199911.........
                .....4...119f911...4.....
                ....444..1999991..444....
                ....444..199f991..444....
                ....444.119999911.444....
                ....424.111151111.424....
                ....42441151115114424....
                ....41411111111111414....
                ....41441511f11514414....
                ....4841111fff1111484....
                ....4844111fff1114484....
                ....444111fffff111444....
                ....44441111111114444....
                ....4441111111111.444....
                .....c..ccccccccc..c.....
                ....ccc.cc.ccc.cc.ccc....
                .......ccccccccccc.......
                .........................
                .........................
                .........................
                .........................
                .........................
                .........................
                .........................
                .........................
                .........................
                .........................
                .........................
                .........................
            `, SpriteKind.Player)
            scaling.scaleToPercent(Ship, 200, ScaleDirection.Uniformly, ScaleAnchor.Middle)
            Ship.setPosition(100, 80)
            let controllTower = sprites.create(img`
    . . . . . . . . . . . . . . . .
    . . . . f f c c d d . . . . . .
    . . . f 6 9 9 8 8 8 d . . . . .
    . . . 6 6 6 9 9 9 8 8 . . . . .
    . . . 6 6 9 9 9 8 8 8 . . . . .
    . . . f 6 6 9 9 9 8 d . . . . .
    . . . . f f c c d d . . . . . .
    . . . . f f c c d d . . . . . .
    . . . . f f f c d d . . . . . .
    . . . . f f c d c d . . . . . .
    . . . . f f c c d d . . . . . .
    . . . . f c c c d d . . . . . .
    . . . . f f c d d d . . . . . .
    . . . . f f f c d d . . . . . .
    . . . . f c c c c d . . . . . .
    . . . . f f c c d d . . . . . .
`)
            controllTower.setPosition(30, 80)
            scaling.scaleToPercent(controllTower, 400, ScaleDirection.Uniformly, ScaleAnchor.Middle)
            story.spriteSayText(controllTower, "We have recived a disstress signal!")
            story.spriteSayText(controllTower, "Launch the rescue rocket!")

            scene.cameraShake(4, 2000)
            animation.runImageAnimation(
                Ship,
                [img`
        .........................
        .........................
        .........................
        .............1...........
        ............111..........
        ...........11111.........
        ...........11111.........
        ..........1111111........
        ..........1199911........
        ......4...119f911...4....
        .....444..1999991..444...
        .....444..199f991..444...
        .....444.119999911.444...
        .....424.111151111.424...
        .....42441151115114424...
        .....41411111111111414...
        .....41441511f11514414...
        .....4841111fff1111484...
        .....4844111fff1114484...
        .....444111fffff111444...
        .....44441111111114444...
        .....444.111111111.444...
        ......c..ccccccccc..c....
        .....ccc.cc.ccc.cc.ccc...
        .....424ccccccccccc424...
        ......5..424252244..5....
        ........54222222244......
        ........5222424244.......
        ........45254222245......
        ........54442425455......
        ........5542544245.......
        .........544425554.......
        .........452455455.......
        ..........545525.........
        ...........5.45..........
        .........................
        .........................
        .........................
    `, img`
        .........................
        .........................
        .........................
        .............1...........
        ............111..........
        ...........11111.........
        ...........11111.........
        ..........1111111........
        ..........1199911........
        ......4...119f911...4....
        .....444..1999991..444...
        .....444..199f991..444...
        .....444.119999911.444...
        .....424.111151111.424...
        .....42441151115114424...
        .....41411111111111414...
        .....41441511f11514414...
        .....4841111fff1111484...
        .....4844111fff1114484...
        .....444111fffff111444...
        .....44441111111114444...
        .....444.111111111.444...
        ......c..ccccccccc..c....
        .....ccc.cc.ccc.cc.ccc...
        .....252ccccccccccc252...
        ......4..4242422.4..4....
        ........52422522244......
        ........52.2424244.......
        ........4525.525245......
        ........54.4242.455......
        ........524254.242.......
        .........5.4..5.5........
        ..........5245..55.......
        ............2............
        .........................
        .........................
        .........................
        .........................
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....545ccccccccccc545...
            ......2..424245254..2....
            ........5245252224.......
            ........5252424542.......
            ........44242245245......
            ........54542424555......
            ........5244552242.......
            .......2.454224554.......
            .......25452452255.......
            .........5542425.........
            ...........55.5.4........
            .........................
            .........................
            .........................
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24245254..5....
            ..........25252424.......
            ........4542524242.......
            .......454242545245......
            ........44554254552......
            ..........42452242.......
            ..........252425454......
            ...........455424224.....
            ............25252454.....
            .............24245.......
            .............545.........
            ..............22.........
            .........................
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24225224..5....
            ..........25252424.......
            ..........42425242.......
            ..........242245445......
            .........4545544252......
            .........242425224.......
            ..........244244524......
            ..........42254252.......
            ..........44245524.......
            ...........2524255.......
            ...........445442........
            ...........24.25.........
            ............555..........
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....545ccccccccccc545...
            ......2...22442224..2....
            ..........22252424.......
            ..........442222524......
            .........42542442454.....
            .........4542425452......
            ..........45524452.......
            ..........24242524.......
            .........224544255.......
            ........2545252524.......
            .........44542.42........
            .........54224...........
            ...........5.............
            .........................
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24225224..5....
            ..........25252424.......
            ..........42425242.......
            ..........242245445......
            .........4545544252......
            .........242425224.......
            ..........244244524......
            ..........42254252.......
            ..........44245524.......
            ...........2524255.......
            ...........445442........
            ...........24.25.........
            ............555..........
        `, img`
            .........................
            .........................
            .........................
            .............1...........
            ............111..........
            ...........11111.........
            ...........11111.........
            ..........1111111........
            ..........1199911........
            ......4...119f911...4....
            .....444..1999991..444...
            .....444..199f991..444...
            .....444.119999911.444...
            .....424.111151111.424...
            .....42441151115114424...
            .....41411111111111414...
            .....41441511f11514414...
            .....4841111fff1111484...
            .....4844111fff1114484...
            .....444111fffff111444...
            .....44441111111114444...
            .....444.111111111.444...
            ......c..ccccccccc..c....
            .....ccc.cc.ccc.cc.ccc...
            .....424ccccccccccc424...
            ......5...24245254..5....
            ..........25252424.......
            ........4542524242.......
            .......454242545245......
            ........44554254552......
            ..........42452242.......
            ..........252425454......
            ...........45542422......
            ............2525245......
            .............24245.......
            .............545.........
            ..............22.........
            .........................
        `],
                200,
                true
            )
            story.spriteMoveToLocation(Ship, 90, -40, 100)
            Ship.destroy()
            controllTower.destroy()
            scene.setBackgroundImage(img`
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . . .
        `)
            bgnGame()
        }

        // skip to level
    } else if (story.getLastAnswer() == "Skip to level") {
        let lvlSkp = game.askForNumber("Enter level number. To go back enter 0.", 2)
        

        if (lvlSkp == 1) {
            bgnGame()
        } else if (lvlSkp == 2) {
            lvl2(true)
        } else if (lvlSkp == 3) {
            lvl3(true)
        
        } else if (lvlSkp == 4) {
            lvl4()
        
        } else if (lvlSkp == 0 || lvlSkp == 0o0) {
            game.reset()
        } else {
            story.printText("Invalid level number!", 40, 0)
            game.reset()
        }

}
}


function freePlay () {
    


    story.showPlayerChoices("Basic", "Advanced", "Home")
    if (story.getLastAnswer() == "Basic") {
        
                isInMenue = false
                bLvlSetUp(speed, fpause, 10000, true, true, 999999)
    
           
            
    

        } else if (story.getLastAnswer() == "Advanced"){
        advFreePlay()
        

        }
  

}



function advFreePlay() {
    speed = settings.readNumber("fSpeed")
    fpause = settings.readNumber("fPause")


    story.showPlayerChoices('Top asteroid settings', 'Side Asteroid settings', 'Play', 'Go home')
    
    if (story.getLastAnswer() == 'Top asteroid settings') {
        topAstros()
    function topAstros () {
        story.showPlayerChoices("Change speed", "Change rate of asteroids", `Top asteroids = ${topAsteroids}`, 'Back')
    
        if (story.getLastAnswer() == `Top asteroids = ${topAsteroids}`) { // turn top asteroid on or off
    
            if (topAsteroids == " Off") {
                topAsteroids = " On"
                realTopAsteroids = true
                settings.writeString('fTopAsteroids', 'true')
                topAstros()
 
            } else {
                topAsteroids = " Off"
                realTopAsteroids = false
                settings.writeString('fTopAsteroids', 'false')
                topAstros()

            }

        } else if (story.getLastAnswer() == "Change speed") {
            speed = game.askForNumber(`Defalt = 120; current = ${speed}`, 3)
            console.log(`fSpeed = ${speed}`)

            if (speed) {
                console.log("ifed!")
                blockSettings.writeNumber("fSpeed", speed)
            }

            console.log(`setting = ${blockSettings.readNumber("fSpeed")}`)
            speed = settings.readNumber("fSpeed")
            console.log(`fSpeed = ${speed}`)


            topAstros()



        } else if (story.getLastAnswer() == "Change rate of asteroids") {

            fpause = game.askForNumber("defalt = 800; current = ".concat(fpause), 4)
            console.log(`fpause = ${fpause}`)

            if (fpause) {
                console.log("ifed!")
                blockSettings.writeNumber("fPause", fpause)
            }
            console.log(`setting = ${blockSettings.readNumber("fPause")}`)
            fpause = settings.readNumber("fPause")
            console.log(`fpause = ${fpause}`)
            topAstros()
    
        } else if (story.getLastAnswer() == 'Back') {
            advFreePlay()
        }

    
    }
    } else if (story.getLastAnswer() == 'Side Asteroid settings') {

        sideAstros()
        function sideAstros() {
        story.showPlayerChoices("Change speed", "Change rate of asteroids", `Side asteroids = ${sideasteroids}`, 'Back')

        if (story.getLastAnswer() == `Side asteroids = ${sideasteroids}`) { // turn Side asteroid on or off

            if (sideasteroids == " Off") {
                sideasteroids = " On"
                realSideAsteroids = true
                settings.writeString('fSideAsteroids', 'true')
                sideAstros()

            } else {
                sideasteroids = " Off"
                realSideAsteroids = false
                settings.writeString('fSideAsteroids', 'false')
                sideAstros()

            }

        } else if (story.getLastAnswer() == "Change speed") {

            sideSpeed = game.askForNumber(`Defalt = 92; Current = ${sideSpeed}; Enter .5 for random`, 3)

            if (sideSpeed) { // if sideSpeed is not NaN (not a number(meaning the player did not enter anything))
                blockSettings.writeNumber("FSideSpeed", sideSpeed) // set the save to what the player enterd
            } else { // if the player entered nothing

            let sideSpeedHolder = blockSettings.readNumber("FSideSpeed") // a place holder variable, beacuse for some reason we cannot change sideSpeed to the setting FSideSpeed directly
            sideSpeed = sideSpeedHolder

            }

            fSideMinSpeed = sideSpeed

            if (sideSpeed == .5) { /* needs more atention */
                
                console.log("ifed!")
                sideSpeed = 130
                fSideMinSpeed = 40
            }

            sideAstros()


        } else if (story.getLastAnswer() == "Change rate of asteroids") {

            fSidePause = game.askForNumber(`defalt = 1900; current = ${fSidePause}`, 4)

            if (fSidePause) {
                blockSettings.writeNumber("fSidePause", fSidePause)
            fSidePause = settings.readNumber("fSidePause")
            sideAstros()
            }

        } else if (story.getLastAnswer() == 'Back') {
            advFreePlay()
        }
        
        }

    } else if (story.getLastAnswer() == 'Play'){
  
        isInMenue = false
        info.setScore(0)

        if (realSideAsteroids == true && realTopAsteroids == true) {
            timer.background(function () {
                advLvlSetUp(fSideMinSpeed, sideSpeed, fSidePause, 10000, false, false, 999999, 80, 110, 0, false, true, false)
            })
            timer.background(function () {
                advLvlSetUp(fSideMinSpeed, sideSpeed, fSidePause, 10000, false, false, 999999, -80, -110, 160, false, true, false)
            })
        }


        timer.background(function () {
            godMode = true
            timer.after(2000, function () {
                godMode = false
            })
        })

        if (isFreeplayOnUpdategoing == false) {
            isFreeplayOnUpdategoing = true
            game.onUpdateInterval(1000, function () {
                if (alive == true) {
                    info.changeScoreBy(1)
                }
            })
        }

        if (realTopAsteroids == true) {
        advLvlSetUp(speed, speed, fpause, 10000, true, true, 999999, 0, 0, 0, true, false, false)
        } else {
            timer.background(function () {
                advLvlSetUp(fSideMinSpeed, sideSpeed, fSidePause, 10000, false, true, 999999, 80, 110, 0, false, true, false)
            })
 
                advLvlSetUp(fSideMinSpeed, sideSpeed, fSidePause, 10000, false, false, 999999, -80, -110, 160, false, true, false)

        }
        info.setScore(null)
        advFreePlay()
    }
}






menue() // start the game